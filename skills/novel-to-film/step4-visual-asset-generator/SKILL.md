---
name: visual-asset-generator
description: 将阶段3各元素圣经中的 AI 绘图提示词通过 Seedream 实际执行生成图片，经一致性筛选后形成视觉资产库（角色肖像、角色阶段图、场景概念图、道具设计图）+ asset_index.md 资产索引，供下游分镜、首帧合成、视频生成直接使用。
---

# 视觉资产生成

## 定位

视觉资产生成是连接"文字描述"与"可用画面"的关键桥梁。阶段3产出的圣经文件定义了每个元素"应该长什么样"，本阶段的任务是**把这些文字描述变成实际图片**，并将确认后的图片编入结构化的资产库。

没有这一步，后续的首帧合成（阶段6）和视频生成（阶段7）无从谈起——它们需要的不是文字描述，而是实实在在的参考图文件。

在好莱坞制作流程中，本阶段对应 **Concept Art / Character Sheet / Look Development** 阶段——概念设计师根据制作圣经绘制角色设定图、场景概念图、道具设计图，经导演确认后成为全片的视觉基准。AI 制作流中，Seedream 替代了概念设计师的执行工作，但"筛选确认"的环节仍然不可省略。

## 核心原则

1. **圣经驱动**——所有生成都基于阶段3圣经中的 AI 绘图提示词，不可凭空创造。提示词是"配方"，Seedream 是"厨房"，本阶段的工作是"做菜并选出最好的端上桌"
2. **一致性是生命线**——同一角色在不同图片中必须长得一样。这是整个流水线中最大的技术挑战，也是本阶段最核心的质量标准
3. **肖像先行**——角色资产生成必须先完成肖像（A板块），确认肖像基线后，再用肖像作为参考图生成各阶段场景图（B板块）。这个顺序不可颠倒
4. **stage_id 即目录名**——资产文件夹结构必须严格使用圣经阶段注册表中的 `stage_id`，一个字都不能差。这是下游阶段5/6精准定位参考图的唯一路径
5. **宁缺毋滥**——不合格的图片（一致性不达标、画风偏离、细节错误）不能进入资产库。进入资产库的每一张图都会影响全片几十甚至上百个镜头
6. **全局风格统一**——所有生成都必须使用阶段2定义的全局 style prompt 前缀，确保角色、场景、道具在画风上统一

## 输入

- `production/step3-bibles/characters/` 下的全部角色圣经（第九章：AI绘图提示词 A+B 板块）
- `production/step3-bibles/locations/` 下的全部场景圣经（第八章：AI绘图提示词）
- `production/step3-bibles/props/` 下的全部道具圣经（最后一章：AI绘图提示词）
- `production/step2-art-direction/art_direction.md`——全局视觉风格定义（第七章：全局 Style Prompt 前缀）

**研究方法**：
1. 先读 `production/step2-art-direction/art_direction.md` 第七章，提取全局 style prompt 前缀
2. 按元素类型批量读取各圣经的 AI 绘图提示词章节
3. 校验每个提示词是否已包含全局 style prompt 前缀（应已在圣经编写时自动继承）
4. 校验每个提示词是否包含中英双语版本（英文版用于 Seedream 生成，中文版用于人工审核）——如缺少中文版，需补充英文版的直译

## 输出

`production/step4-assets/` 下的完整视觉资产库：

```
production/step4-assets/
├── characters/
│   ├── 朱围庸/
│   │   ├── _portrait/               # 角色肖像（跨阶段视觉基线）
│   │   │   ├── 正面半身像.png
│   │   │   ├── 四分之三侧面半身像.png
│   │   │   ├── 正侧面半身像.png
│   │   │   ├── 全身正面像.png
│   │   │   ├── 背面全身像.png        # ★★★★★ 主角扩展
│   │   │   └── 眼部特写.png          # ★★★★★ 主角扩展
│   │   ├── 灵魂期/                   # 阶段场景图（按 stage_id）
│   │   │   └── *.png
│   │   ├── 占身丁路期/
│   │   │   └── *.png
│   │   └── 占身乞丐期/
│   │       └── *.png
│   └── 宋小仙/
│       ├── _portrait/
│       │   └── ...
│       ├── 追魂使期/
│       │   └── ...
│       └── ...
├── locations/
│   ├── 恶灵区/
│   │   ├── 默认/
│   │   │   └── *.png
│   │   └── 战后/
│   │       └── *.png
│   └── ...
├── props/
│   ├── 美女榕根系/
│   │   ├── 完好期/
│   │   │   └── *.png
│   │   └── 断裂期/
│   │       └── *.png
│   └── 泉水/
│       └── *.png
└── asset_index.md                    # 资产索引（核心映射表）
```

**目录命名规则**：
- 角色/场景/道具的一级目录名 = 圣经文件名（去掉 `.md`）
- 阶段子目录名 = 圣经阶段注册表中的 `stage_id`，**字面完全一致**
- 角色肖像统一放在 `_portrait/` 子目录（下划线前缀确保排在阶段目录之前）
- 无阶段注册表的道具，图片直接放在道具名目录下，无需子目录

---

## 工作流程

### 第一步：生成计划制定

扫描全部圣经文件，统计待生成的资产总量：

| 元素类型 | 统计维度 | 示例 |
|---------|---------|------|
| 角色 | 角色数 × (肖像视角数 + 阶段数) | 3主角×(6+3阶段) + 29配角×(4+N阶段) |
| 场景 | 场景数 × 阶段数 × 每阶段提示词数 | 10场景 × 平均2阶段 × 平均2张 |
| 道具 | 道具数 × (阶段数 or 1) × 提示词数 | 17道具 × 平均2张 |

制定生成优先级：
1. **P0 角色肖像**——所有 ★★★★★/★★★★☆ 角色的肖像（这是一切的基础）
2. **P1 主角阶段图**——★★★★★ 主角的各阶段场景图（使用肖像作为一致性参考）
3. **P2 主要场景**——★★★★★ 场景的各阶段概念图
4. **P3 配角阶段图**——★★★★☆ 配角的阶段图
5. **P4 道具和次要场景**——道具设计图 + ★★★★☆ 场景

### 第二步：角色肖像生成（P0）

这是整个资产生成的**最关键步骤**。角色肖像是后续所有角色相关图片的一致性锚点。

**流程**：

```
读取角色圣经第九章A板块（角色肖像提示词）
    ↓
逐视角生成（正面半身像 → 3/4侧面 → 正侧面 → 全身正面）
    ↓
一致性验证（同一角色的多视角图片，面部特征是否一致？）
    ↓
不合格 → 重新生成（调整 seed / 微调提示词）
    ↓
合格 → 存入 characters/{角色名}/_portrait/
```

**一致性验证要点**：
- 面部五官比例在不同视角中是否一致（尤其关注鼻子、下颌线、发际线）
- 体型比例在半身像和全身像中是否一致
- 肤色在不同视角中是否一致（注意光照变化可能导致的色差）
- 发型轮廓在不同视角中是否匹配

**Seedream 4.0+ 使用建议**：
- 使用相同的 seed 值生成同一角色的不同视角，提高一致性
- 如果平台支持角色一致性融合（Character Consistency）功能，用第一张正面像作为参考图生成后续视角
- 批量生成后逐张人工审核，不合格的标记重新生成

### 第三步：角色阶段图生成（P1/P3）

角色肖像确认后，用肖像作为一致性参考，生成各阶段的场景图。

**流程**：

```
读取角色圣经第九章B板块（阶段场景提示词）
    ↓
逐 stage_id 生成
    ↓
使用 _portrait/ 中的正面肖像作为 Seedream 的参考图输入
    ↓
一致性验证（阶段图中的角色面貌是否与肖像一致？）
    ↓
不合格 → 重新生成
    ↓
合格 → 存入 characters/{角色名}/{stage_id}/
```

**关键约束**：
- 每个 `stage_id` 至少生成一张图
- 阶段图中的服装、环境必须与该阶段的圣经描写一致
- 面貌必须与肖像基线一致——**服装可以变、环境可以变、表情可以变，但脸不能变**

### 第四步：场景概念图生成（P2/P4）

**流程**：

```
读取场景圣经第八章（AI绘图提示词）
    ↓
逐 stage_id 生成
    ↓
按提示词指定的视角生成（全景、内部、关键区域等）
    ↓
风格一致性验证（是否符合全局 Art Direction？）
    ↓
合格 → 存入 locations/{场景名}/{stage_id}/
```

**验证要点**：
- 色彩基调是否在全局 Art Direction 定义的范围内
- 光影风格是否与场景圣经第四章（光影与氛围）的描述一致
- 空间比例是否合理（建筑高度、通道宽度等）
- 标志性视觉锚点是否存在且位置正确

### 第五步：道具设计图生成（P4）

**流程**：

```
读取道具圣经最后一章（AI绘图提示词）
    ↓
有阶段注册表 → 逐 stage_id 生成
无阶段注册表 → 直接生成概念图 + 场景图
    ↓
验证：尺寸感、材质质感、细节特征是否与圣经描写一致
    ↓
合格 → 存入 props/{道具名}/{stage_id}/ 或 props/{道具名}/
```

**验证要点**：
- 道具的尺度感是否正确（对比参照物）
- 材质质感是否与圣经描写匹配（金属光泽、木纹、做旧程度等）
- 超自然道具的光效颜色和亮度是否与 Art Direction 超自然光效规范一致

### 第六步：编写 asset_index.md

所有资产生成并确认后，编写资产索引文件。这是下游阶段5/6查找参考图的**唯一入口**。

**格式**：

```markdown
# 视觉资产索引

> 本文件由阶段4（视觉资产生成）产出，是阶段5（分镜脚本）和阶段6（首帧合成）查找参考图的核心映射表。
> 分镜脚本中标注"角色名（阶段：{stage_id}）"后，直接在本表中查找对应的参考图路径。

## 角色资产

| 角色名 | 类型 | stage_id | 章节范围 | 参考图路径 | 图片数 |
|--------|------|----------|---------|-----------|--------|
| 朱围庸 | 肖像 | — | — | characters/朱围庸/_portrait/ | 6 |
| 朱围庸 | 阶段 | 灵魂期 | ch1-3 | characters/朱围庸/灵魂期/ | 1 |
| 朱围庸 | 阶段 | 占身丁路期 | ch4-7 | characters/朱围庸/占身丁路期/ | 1 |
| 朱围庸 | 阶段 | 占身乞丐期 | ch8-71 | characters/朱围庸/占身乞丐期/ | 2 |

## 场景资产

| 场景名 | stage_id | 章节范围 | 参考图路径 | 图片数 |
|--------|----------|---------|-----------|--------|
| 恶灵区 | 默认 | ch3-69 | locations/恶灵区/默认/ | 2 |
| 恶灵区 | 战后 | ch70-71 | locations/恶灵区/战后/ | 1 |

## 道具资产

| 道具名 | stage_id | 章节范围 | 参考图路径 | 图片数 |
|--------|----------|---------|-----------|--------|
| 美女榕根系 | 完好期 | ch1-45 | props/美女榕根系/完好期/ | 1 |
| 美女榕根系 | 断裂期 | ch46-71 | props/美女榕根系/断裂期/ | 1 |
| 泉水 | — | ch1-71 | props/泉水/ | 2 |
```

**编写规则**：
- 角色资产表中，肖像行的 stage_id 和章节范围填 `—`，类型填 `肖像`
- 每个 stage_id 的参考图路径精确到目录级（不列具体文件名，用目录 + 图片数）
- stage_id 和章节范围必须与圣经阶段注册表完全一致
- 按元素类型分节（角色/场景/道具），每节内按重要性降序排列

### 第七步：全局一致性审查

所有资产生成完毕后，进行最终的全局审查：

**跨角色一致性**：
- 同一场景中出场的多个角色，画风是否统一？
- 不同角色之间的体型比例关系是否合理？

**角色-场景一致性**：
- 将角色阶段图与对应场景概念图对比：光影色调是否匹配？
- 角色服装的时代感是否与场景建筑风格一致？

**全局风格一致性**：
- 所有图片的整体画风是否统一？是否有明显的风格跳跃？
- 色彩基调是否在 Art Direction 定义的范围内？

**资产索引完整性**：
- asset_index.md 中的每一行，对应的文件路径是否真实存在？
- 每个圣经中阶段注册表的 stage_id，是否在 asset_index.md 中都有对应行？
- 是否有资产文件存在但未被索引的情况？

---

## 一致性保障机制

一致性是视觉资产生成的最大挑战。以下是建议的保障机制：

### 角色一致性

**Seedream 4.0+ 角色一致性功能**：
- 为每个角色建立"角色锚点"——即 `_portrait/正面半身像.png`
- 后续所有该角色的图片生成，都将此锚点作为参考图输入
- 参考图权重建议设为 0.6-0.8（过高会限制姿态变化，过低会丢失面部特征）

**多次生成择优策略**：
- 每个提示词生成 3-5 张候选图
- 从候选中选出与肖像锚点一致性最高的 1 张
- 不合格的候选标记原因（面部偏差/体型偏差/服装错误/风格偏离），用于调整下一轮生成

**一致性评分维度**（人工审核时参考）：

| 维度 | 权重 | 检查点 |
|------|------|--------|
| 面部特征 | 40% | 五官比例、脸型、肤色 |
| 体型比例 | 20% | 身高、体态、肩宽 |
| 发型 | 15% | 发型轮廓、发色、发量 |
| 服装正确性 | 15% | 是否与该阶段描写一致 |
| 画风统一 | 10% | 是否与全局 Art Direction 一致 |

### 场景一致性

- 同一场景的不同阶段图，空间结构骨架必须一致（建筑位置、地形轮廓不变，只有状态变化）
- 标志性视觉锚点（如恶灵区的十八层塔、牛台山的美女榕）必须在所有该场景的图片中出现且位置一致

### 道具一致性

- 同一道具的不同视角图，形状、材质、色彩必须一致
- 有阶段变化的道具，不同阶段图之间的"不变部分"（整体形状、核心特征）必须保持一致

---

## 重新生成策略

当生成结果不合格时，按以下优先级调整：

1. **换 seed**——最简单的方式，保持提示词不变，更换随机种子
2. **微调提示词权重**——强化需要改进的部分（如加重面部特征描述的权重）
3. **增加负面提示词**——明确排除不需要的特征（如 `negative: blurry face, wrong eye color, modern clothing`）
4. **调整参考图权重**——如果角色面貌偏差大，提高参考图权重；如果姿态僵硬，降低参考图权重
5. **回溯修改提示词**——如果多次生成都不理想，可能是提示词本身有问题，需回到圣经修改 AI 绘图提示词

**记录原则**：每次重新生成都应记录调整内容和结果，形成"生成日志"，供后续相似角色/场景参考。

---

## 常见错误（必须避免）

| 错误 | 后果 | 预防 |
|------|------|------|
| 跳过肖像直接生成阶段图 | 角色面貌在各阶段之间不一致 | 必须先完成肖像并确认，再生成阶段图 |
| 资产目录名与 stage_id 不一致 | 下游分镜/首帧无法通过 asset_index 定位参考图 | 目录名从圣经注册表复制粘贴，不可手打 |
| 未使用全局 style prompt 前缀 | 角色/场景/道具画风不统一 | 每个提示词开头校验前缀是否存在 |
| 一致性不达标就入库 | 同一角色在不同镜头中"变脸" | 每张图入库前必须与肖像锚点对比 |
| asset_index.md 与实际文件不匹配 | 下游查找失败，流水线中断 | 索引编写后逐行验证文件存在性 |
| 所有角色使用相同生成参数 | 不同角色的面部特征趋同 | 每个角色使用独立的 seed 和参考图 |
| 场景图忽略空间结构一致性 | 同一场景的不同阶段图看起来像不同地方 | 用第一张场景图作为后续阶段的构图参考 |
| 道具尺度失真 | 后续合成时道具与角色/场景比例失调 | 生成时包含比例参照物，入库前校验尺度 |
| 生成数量不足 | 特定视角缺失，首帧合成时无合适参考 | 严格按圣经提示词逐条生成，不可跳过 |

## 质量标准

合格的视觉资产库必须满足：

1. **完整覆盖**：每个圣经中的 AI 绘图提示词都有对应的资产文件，无遗漏
2. **角色一致**：同一角色的所有图片（肖像 + 各阶段图）面貌一致，可被识别为同一个人
3. **风格统一**：所有图片的画风在全局 Art Direction 定义的范围内，无明显风格跳跃
4. **stage_id 精确**：资产目录名与圣经阶段注册表 `stage_id` 字面完全一致
5. **索引完整**：asset_index.md 覆盖全部资产，每行对应的文件路径真实存在
6. **下游可用**：阶段5分镜标注"角色名 + stage_id"后，能通过 asset_index.md 精准定位到参考图；阶段6能直接使用参考图作为 Seedream 输入
7. **细节正确**：角色服装与该阶段描写一致、场景标志物存在且位置正确、道具尺度合理
8. **肖像基线**：每个重要角色（★★★★★/★★★★☆）都有完整的肖像集（`_portrait/`），作为全片一致性锚点
